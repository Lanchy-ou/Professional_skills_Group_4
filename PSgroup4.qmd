---
title: "Explanatory Data Analysis: Mercury Exposure in Dentists and Control Group"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
knitr:
  opts_chunk: 
    echo: false
---

## Introduction

The effects of mercury exposure are a concern for many people, more so for dentists as mercury is contained in amalgam fillings which is a very common dental procedure. Dentists now tend to use mercury-free fillings as it is presented as a safer alternative.

To investigate the effects of occupational mercury exposure on dentists data was collected, where mercury exposure was measured by mercury concentration in urine. Data was collected from two groups, the first group being a random sample of 67 Scottish dentists and the second group, the control group, which consisted of 92 subjects from the University of Glasgow who were either staff or postgraduate students, who were not routinely exposed to mercury. Mercury concentrations in urine were measured alongside memory scanning times the review cognitive/neurological of mercury exposure, and the age of the participants was also collected.

The primary objective of this report is to investigate if there is a difference in mercury in urine concentrations between the dentist group and the control group. The secondary objectives are to see if mercury concentration in urine has an impact on memory scanning time. In addition, we will explore the relationship between mercury concentration in urine and memory scanning times between the dentist group and control group. Finally, we will consider whether age influences these potential relationships.

Investigating these factors will increase our understanding on the impact of occupational mercury exposure, particularly if dentists have higher mercury concentrations, how mercury exposure effects cognitive/neurological function and how age contributes to these effects.

```{r}
#| echo: false
#| warning: false
library(tidyverse)
library(tidymodels)
library(moderndive)
library(skimr)
library(knitr)
```

# Introduction

This analysis aims to explore the mercury exposure dataset in dentists and its potential effects on memory scanning reaction times. The dataset consists of observations for two groups: dentists (Group 1) and control subjects (Group 2).

We will perform an exploratory data analysis (EDA) to understand the structure of the data and check for any obvious patterns or relationships among the variables.

The data consists of 159 rows and 5 columns, as shown below:

-   `Group`: (1 for dentists, 2 for control).

-   `Age`: Age of the subject.

-   `Mercury`: Mercury concentration in urine (raw value).

-   `UriMerc`: Log base 10 of mercury concentration in urine .

-   `ReacTim`: Memory scanning reaction time (in milliseconds).

## Data Loading and Preprocessing

```{r}

#| echo: false

data <- read.csv("data.csv")

```

```{r}
data$Group <- as.factor(data$Group)
```

**Age** has an average of 36.2 years, ranging from 22 to 44 years. **Mercury** and **UriMerc** show high variability in mercury levels, with **UriMerc** having some negative log-transformed values. **ReacTim** has a mean of 848 ms with significant variation in reaction times. The dataset has minimal missing data, with only one missing value in **Age**.

## Descriptive Statistics and Summaries

```{r}
#| echo: false

summary_merc <- data %>%
  drop_na() %>%
  group_by(Group) %>%
  summarise(
    mean_Urimerc = mean(UriMerc),
    sd_Urimerc = sd(UriMerc),
    mean_react = mean(ReacTim),
    sd_ReacTim = sd(ReacTim),
    .groups = 'drop'
  )


```

```{r}
library(performance)

#| echo: false
#| eval: false
summary_df <- data.frame(
  Group = c(1, 2),
  mean_Urimerc = c(0.271, -0.449),
  sd_Urimerc = c(0.355, 0.495),
  mean_react = c(888, 817),
  sd_ReacTim = c(199, 158)
)


kable(summary_df, 
      col.names = c("Group", "Mean UriMerc", "SD UriMerc", "Mean Reaction Time", "SD Reaction Time"), caption = "Summary Statistics for Mercury Data by Group")

```

**What evidence is there that log (base10) mercury concentrations in urine is, on average, different for dentists compared with the control group who are not regularly exposed to mercury?**

## Plot the Distribution of Key Variables

### Boxplot of Reaction Time by Group

```{r}
#| echo: false

ggplot(data, aes(x = Group, y = ReacTim, fill = Group)) +
  geom_boxplot() +
  labs(title = "Boxplot of Reaction Time by Group", 
       x = "Group", y = "Reaction Time (ms)") +
  scale_x_discrete(labels = c("1" = "Dentists", "2" = "UofG Postgraduates")) +
  theme(legend.position = "none")

```

**Interpretation:** Dentists have higher reaction times compared to UofG Postgraduates, with more variability and outliers in the dentists' group. This suggests that mercury exposure might be impacting the cognitive speed of dentists more than postgraduates, or other factors may be influencing their reaction time

### Scatterplot of Reaction Time vs. Mercury Concentration (log-transformed)

```{r}
#| echo: false 
#| warning: false

ggplot(data, aes(x = UriMerc, y = ReacTim, color = Group)) +
  geom_point() + 
  labs(title = "Scatterplot of Reaction Time vs Mercury Concentration", 
       x = "Mercury Concentration (UriMerc)", y = "Reaction Time (ms)") +
  scale_fill_manual(values = c("1" = "red", "2" = "blue"), 
                    labels = c("1" = "Dentists", "2" = "UofG Postgraduates")) +
  theme(legend.position = "top")

```

**Interpretation:** There is a very weak positive relationship between mercury concentration and reaction time, indicating that higher mercury levels in urine may have a slight effect on slowing reaction times. However, the weak correlation suggests that other factors may be influencing reaction time more significantly than mercury concentration alone.

### Scatterplot of Age vs. Reaction Time and Mercury

```{r}
#| echo: false

data_clean <- data %>%
  drop_na(Age, ReacTim, UriMerc)



# Age vs Reaction Time
ggplot(data_clean, aes(x = Age, y = ReacTim)) +
  geom_point(aes(color = Group)) +
  labs(title = "Relationship of Age vs Reaction Time",
       x = "Age (years)", y = "Reaction Time (ms)") +
  theme(legend.position = "top") +
  scale_color_discrete(labels = c("1" = "Dentists", "2" = "UofG Postgraduates"))



```

**Interpretation:** There’s no clear relationship between age and reaction time, suggesting that age does not significantly affect cognitive speed in either group. This might imply that age-related decline in cognitive function isn’t a major factor in the observed reaction times, or that age ranges in the data are not broad enough to show a noticeable trend.

```{r}


#  Age vs Mercury Concentration (log-transformed)

#| echo: false
print(paste("Correlation between Reaction Time and Age: ", cor(data$ReacTim, data$UriMerc)))
print(paste("Correlation between Mercury Concentration and Age: ", cor(data$Age, data$UriMerc)))
cor(data$UriMerc, data$Age, use = "complete.obs")
ggplot(data_clean, aes(x = Age, y = UriMerc)) +
  geom_point(aes(color = Group)) +
  labs(title = "Scatterplot of Age vs Mercury Concentration",
       x = "Age (years)", y = "Mercury Concentration (UriMerc)") +
  theme(legend.position = "top") +
  scale_color_discrete(labels = c("1" = "Dentists", "2" = "UofG Postgraduates"))
```

**Interpretation:** The weak negative correlation between age and mercury concentration suggests that older individuals tend to have lower mercury levels in their urine. This could imply that mercury exposure decreases with age, possibly due to reduced exposure or natural biological changes. However, the relationship is weak, indicating that other factors might be more influential on mercury concentration than age.

---
title: "Untitled"
format: html
editor: visual
execute: 
  echo: false
  eval: true
---

# Models to be fitted {#sec-mt}

```{r}
#| echo: false
#| warning: false
#| message: false

library(ggplot2)
library(tidyverse)
library(tidymodels)
library(plotly)
library(gt)
library(MASS)
library(patchwork)
library(moderndive)
library(dplyr)
library(tidyr)
library(sjPlot)
library(performance)
library(kableExtra)
df <- read.csv("data.csv")
df$Group <- as.factor(df$Group)
```

## Primary objective:

### (a)

A two-samples t-test was conducted to directly compare the mean log (base 10) Mercury concentration between the two groups Null hypothesis in both cases:

$H_0$:There is no significant difference in the mean UriMerc between the two groups.($μ_1$=$μ_2$)

$H_1$:There is a significant difference in the mean UriMerc between the two groups. ($μ_1$$\neq$$μ_2$)

```{r}
t_test <- t.test(UriMerc~Group, data = df)
p_value <- t_test$p.value
cat("P_value:",p_value,"\n")
```

We performed a t-test comparing the mean log(base 10)-transformed urinary mercury concentration (UriMerc) between the groups and got a p-value of 1.667636e-20. Since this is much less than 0.05, we reject the null hypothesis and conclude that the groups have significantly different mean mercury levels.

## Secondary objective:

### (b)

We start by fitting a simple linear regression model: $$
y_i = \alpha + \beta_1 x_{1i}+\epsilon_i
\\=\alpha+\beta_{UriMerc}\cdot UriMerc
$$

```{r}
model1 <- linear_reg() |>
  fit(data=df, ReacTim~UriMerc)
```

```{r}
#| echo: false
#| label: tbl-m1
#| tbl-cap: Estimates of the regression model1 coefficients.
tidy(model1) |> gt()
```

As the table show the intercept is about 849.75, meaning that when UriMerc is 0, the predicted outcome is 849.75. The coefficient for UriMerc is 14.23, indicating that for each one-unit increase in UriMerc, the outcome is expected to increase by 14.23 units. However, this effect is not statistically significant (p = 0.569), suggesting that UriMerc does not have a clear impact on the outcome in this model.

### (c)

We fit the full multiple regression model containing all explanatory variables and separate regression lines for each group. The full model can be written as: $$
y_i = \alpha + \beta_1 x_{1i} +\beta_2 x_{2i} +\beta_3 x_{1i} x_{2i} +\epsilon_i
\\=\alpha+\beta_{UriMerc}\cdot UriMerc+\beta_{Group}\cdot \mathbb{I}_{\mathrm{Group}}(x)+\beta_{UriMerc,Group}\cdot UriMerc\cdot \mathbb{I}_{\mathrm{Group}}(x)
$$ where

\- $\alpha$: Baseline intercept (predicted outcome for Group 1 when $UriMerc$=0).

\- $\beta_{UriMerc}$: Effect of $UriMerc$ on the outcome in Group 1.

\- $\beta_{Group}$: Change in intercept for Group 2 compared to Group 1.

\- $\beta_{UriMerc,Group}$: Change in the effect (slope) of $UriMerc$ for Group 2 compared to Group 1.

\- $\mathbb{I}_{\mathrm{Group}}(x)$: Indicator variable that equals 1 for Group 2 and 0 for Group 1.

```{r}
model_2 <- linear_reg() |>
  fit(ReacTim~UriMerc*Group, data=df)
model2_ext <- linear_reg() |>
  fit(ReacTim~UriMerc*Group, data=df) |>
  extract_fit_engine()
model_2$fit
```

```{r}
#| echo: false
#| label: tbl-regtable
#| tbl-cap: Estimates of the regression model coefficients.
get_regression_table(model2_ext) |>
  knitr::kable(
    digits = 3,
    caption = "Full Regression model with interaction term",
    booktabs = TRUE
  )
```

From the coefficient table, the intercept (912.851) represents the predicted reaction time for Group 1 when UriMerc=0. The coefficient for UriMerc (-92.985) implies that each 1-unit increase in UriMerc would lower reaction time by about 93 ms in Group 1, although this effect is not statistically significant (p=0.129). Meanwhile, the coefficient for Group 2 (-103.424) indicates that, at UriMerc=0, reaction time is approximately 103 ms lower than in Group 1 (p=0.006). Finally, the interaction term (73.382) suggests that the slope of UriMerc for Group 2 is 73 ms higher than for Group 1, but this difference is not statistically significant (p=0.304).

And from table we obtain our best-fitting line to the data is: $$
\widehat{ReacTim}=912.851-92.985    \cdot UriMerc-103.424\cdot \mathbb{I}_{\mbox{Group}}(x)+73.382\cdot UriMerc\cdot \mathbb{I}_{\mbox{Group}}(x)
$$\
@fig-scat1 shows how the relationship between urinary mercury concentration (UriMerc) and reaction time (ReacTim) differs by group. Each group has its own regression line, indicating that the effect of UriMerc on ReacTim varies depending on group membership.

```{r}
#| echo: false
#| label: fig-scat1
#| message: false
#| fig-cap: Relationship between reaction time and UriMerc by groups with regression lines superimposed
#| fig-width: 4
#| fig-height: 3
#| fig-align: center
ggplot(df,aes(x=UriMerc,y=ReacTim,color=Group))+
  geom_point()+
  labs(x="UriMerc",y="Reaction time",color="Groups")+
  geom_smooth(method = "lm", se=FALSE)
```

```{r}
regression.points <- get_regression_points(model2_ext)
```

@fig-resids plots the residuals against both UriMerc and the fitted values, grouped by the two categories. The points appear evenly scattered around zero, suggesting that the residuals have a mean of zero and no obvious pattern that would indicate non-constant variance or a missing variable. The variance of the residuals looks relatively consistent across all levels of UriMerc and the fitted values, indicating homoscedasticity.

```{r}
#| echo: false
#| fig-cap: Residual versus UriMerc (left) and the fitted values (right) by species.
#| label: fig-resids
#| fig-width: 4
#| fig-height: 3
#| fig-align: center

p1 <- ggplot(regression.points,aes(x=UriMerc,y=residual))+
  geom_point()+
  labs(x="UriMerc",y="Residual")+
  geom_hline(yintercept = 0,col="blue",linewidth=1)+
  facet_wrap(~Group)
p2 <- ggplot(regression.points,aes(x=ReacTim_hat,y=residual))+
  geom_point()+
  labs(x="Fitted values",y="Residual")+
  geom_hline(yintercept = 0,col="blue",linewidth=1)+
  facet_wrap(~Group)
p1+p2+plot_layout(ncol=2)
```

@fig-residhist shows histograms of the residuals for each group. Both distributions appear roughly bell-shaped and centered around zero, suggesting the residuals are normally distributed with a mean of zero. This supports the assumption of normality.However, deviations at the tails indicate potential outliers or heavier tails, suggesting a slightly non-normal distribution in extreme values.

```{r}
#| echo: false
#| message: false
#| warning: false
#| label: fig-residhist
#| fig-cap: Histograms of the residuals by species.
#| fig-width: 4
#| fig-height: 3
#| fig-align: center
hist_plot <- ggplot(regression.points,aes(x=residual))+
  geom_histogram(color="white")+
  labs(x="Residual")+
  facet_wrap(~Group)
qq_plot <- ggplot(regression.points,aes(sample=residual))+
  stat_qq()+
  stat_qq_line(color="red")+
  facet_wrap(~Group)+
  labs(title = "Q-Q Plot",x="Residual",y="Count")
hist_plot+qq_plot+plot_layout(ncol = 2)
```

### (d)

We need to add one covariates age to the full model: $$
y_i = \alpha + \beta_1 x_{1i} +\beta_2 x_{2i} +\beta_3 x_{1i} x_{2i} +\beta_4x_{3i}+\epsilon_i
\\=\alpha+\beta_{UriMerc}\cdot UriMerc+\beta_{Group}\cdot \mathbb{I}_{\mathrm{Group}}(x)+\beta_{UriMerc,Group}\cdot UriMerc\cdot \mathbb{I}_{\mathrm{Group}}(x)+\beta_{age}\cdot Age
$$

```{r}
model_3 <- linear_reg() |>
  fit(ReacTim~UriMerc*Group+Age,data=df)
model_3$fit
model3_ext <- linear_reg() |>
  fit(ReacTim~UriMerc*Group+Age,data=df) |>
  extract_fit_engine()
regression.points2 <- get_regression_points(model3_ext)
```

```{r}
#| echo: false
#| label: tbl-age
#| tbl-cap: Estimates of the regression model coefficients.
get_regression_table(model3_ext) |>
  knitr::kable(
    digits = 3,
    caption = "Regression model with interaction term",
    booktabs = TRUE
  )
```

As the @tbl-age shows, the coefficient for age is 4.973, meaning that for each additional year of age, the reaction time increases by about 5 milliseconds, holding all other variables constant. This effect is statistically significant (p\<0.001), with a 95% confidence interval ranging from approximately 2.3 to 7.7 milliseconds.

```{r}
#| echo: false
#| label: tbl-MC
#| tbl-cap: Model Comparison
model1_com <- linear_reg() |>
  fit(data=df,ReacTim~UriMerc*Group) |>
  extract_fit_engine() |>
  glance()
model3_com <- linear_reg() |>
  fit(data=df,ReacTim~UriMerc*Group+Age) |>
  extract_fit_engine() |>
  glance()

Models <- c("Model1","Model3")
df_test <- bind_rows(model1_com, model3_com, .id = "Model") |>
  as.data.frame() |>  
  mutate(Model = as.character(Model))  

colnames(df_test) <- trimws(colnames(df_test)) 

df_test_selected <- df_test |> dplyr::select(Model, adj.r.squared, AIC, BIC)

df_test_selected |> kable(
  digits = 2,
  caption = "Model Comparison Values for different models."
)
```

As the @tbl-MC shows, Model 2, which includes age, shows a higher adjusted R-square (0.11 compared to 0.03) and lower AIC (2077.44 vs. 2100.98) and BIC (2095.81 vs. 2116.32) values than Model 1. This indicates that the extended model provides a better balance between goodness-of-fit and model complexity, suggesting that adding age improves the model performance and should be preferred.

# Discussions and Conclusions

## Summary of Findings

## Limitations

While this study gives a great insight into the effect of mercury on dentists, it also has many limitations.

The first limitation of this study is the small sample size. The results are not generalizable to a large population as it only investigates Scottish dentists and staff and students from Glasgow University. This could be counteracted by using a random sample of dentists in the UK or worldwide, and the control group being a random selection of non-dentists.

Another limitation of this study, closely related to the sample size, is the non-randomized study design. The dentists and the controls are not randomly assigned to their groups in this study. This study could benefit from a randomized design to investigate the true relationship between mercury and reaction time without any bias.

Another limitation is the amount of confounding variables such as age, sex, education, and medical conditions. All of these factors could affect reaction time and mercury exposure. Even though all participants have been or are going to university there could be a real difference in intellectual ability and therefore reaction time. Even other medical conditions could affect mercury concentration and reaction time in participants. Certain diets and food, such as tuna fish, also contribute to the levels of mercury in urine and this could affect findings. All of these variables would need to be controlled or kept constant to keep the validity of the study.
